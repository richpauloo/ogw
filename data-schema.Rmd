---
title: "Data schema"
description: |
  OGW schema is informed by the XXX's periodic groundwater level database, and provides the foundation for an interoperable data management system
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(magrittr)
library(kableExtra)
library(here)
library(readr)
library(stringr)
library(dplyr)
```


# What is a data schema?

A data schema is a rulebook for how databases store information, and a common language to ensure that data collected by different parties is standardized. The OGW data schema ensures interoperability if and when data is exchanged, and enforces rules for incoming data that can prevent "bad" data from sneaking in. OGW seamlesslty integrates fragmented data collection efforts across basin boundaries.  

The OGW schema, based on the [Periodic Groundwater Level Measurement database](https://data.cnra.ca.gov/dataset/periodic-groundwater-level-measurements) relates three tables that join on the "`ID`" column, which designates the ID of a monitoring well. The three tables are:  

1. **measurements**: groundwater level information  
2. **stations**: monitoring well locations
3. **well_perforations**: well construction information


## measurements

* these data types need to be updated to SQL data types, e.g., `site_code` should have type `VARCHAR(18) NOT NULL`.

```{r, measurements}
read_csv(here("data","DataDictionary_measurements.csv")) %>% 
  slice(-1) %>% 
  select(-X1) %>% 
  select(column, type, description) %>% 
  mutate(
    column = tolower(column),
    description = str_wrap(description, 80)
  ) %>% 
  kable("html", escape = F) %>%
  kable_styling(full_width = F, bootstrap_options = c("striped", "hover"))
```

## stations

* these data types need to be updated to SQL data types, e.g., `latitude` and `longtidude` should have type `DECIMAL(9,6) NOT NULL`.

```{r, stations}
read_csv(here("data","DataDictionary_stations.csv")) %>% 
    slice(-1) %>% 
    select(-c("X1","label")) %>% 
    select(column, type, description) %>% 
    mutate(
        column = tolower(column),
        description = str_wrap(description, 80)
    ) %>% 
    kable("html", escape = F) %>%
    kable_styling(full_width = F, bootstrap_options = c("striped", "hover"))
```

## well_perforations

* these data types need to be updated to SQL data types, e.g., `bot_ft_int` and `longtidude` should have type `FLOAT8`.

```{r, well_perforations}
read_csv(here("data","DataDictionary_perforations.csv")) %>% 
  slice(-1) %>% 
  select(-c("X1","label")) %>% 
  select(column, type, description) %>% 
  mutate(
    column = tolower(column),
    description = str_wrap(description, 80)
  ) %>% 
  kable("html", escape = F) %>%
  kable_styling(full_width = F, bootstrap_options = c("striped", "hover"))
```

# Getting started

The most up-to-date version of OGW's data schema can be downloaded from the [OGW Github page](github.com). `SQL`, `Python`, and `R` data schema setup are provided below for an example Postgres database.

## SQL setup

```sql
CREATE TABLE gsp.measurements (

);

CREATE TABLE gsp.stations (

);

CREATE TABLE gsp.well_perforations (

);
```

## Python setup

```python
# Import relevant libraries 
import sqlalchemy as sa
import os

# Set database parameters
host     = "host_name"
database = "database_name"
username = "user"
password = "password"
port     = 1234

# Connection string
conn_string = f"postgresql://{username}:{password}@{host}:{port}/{database}"

# Connect to database
engine = sa.create_engine(conn_string)
conn   = engine.connect()

# Create "gsp" schema

conn.execute("""
    CREATE SCHEMA IF NOT EXISTS gsp;
""")


# Create "measurements" table
try:
    conn.execute("""
        DROP TABLE IF EXISTS measurements CASCADE;
        CREATE TABLE gsp.measurements (

        );
        """)

    print("Table 'measurements' created successfully in PostgreSQL ")
    
except Exception as error:
    print ("Error while creating PostgreSQL table", error)


# Create "gsp.stations" table
try:
    conn.execute("""
        DROP TABLE IF EXISTS gsp.stations CASCADE;
        CREATE TABLE gsp.stations ( 

        );
""")
    print("Table 'stations' created successfully in PostgreSQL ")
    
except Exception as error:
    print ("Error while creating PostgreSQL table", error)
    
    
# Create "gsp.well_perforations" table
try:
    conn.execute("""
        DROP TABLE IF EXISTS gsp.well_perforations CASCADE;
        CREATE TABLE gsp.well_perforations ( 

        );
""")
    print("Table 'well_perforations' created successfully in PostgreSQL ")
    
except Exception as error:
    print ("Error while creating PostgreSQL table", error)
```

## R setup

```r
r_code_goes <- here()
```

